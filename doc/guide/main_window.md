# MainWindow - 主界面 {#guide-main_window}

MainWindow 服务是框架为上层应用提供的界面模板，它已经预实现了框架各种服务所需的界面，因此上层应用只需关注自己特有的界面即可。

## 界面拓展

为了支持上层应用近乎无限的界面变动需求，主界面上的所有组件都是 MainWindow 类的公有成员，从而允许上层的自由修改。

由于主界面上的组件之间包含预实现的关联逻辑，如果在修改主界面时不多加小心，将可能导致错误的显示效果。因此，MainWindow 提供了一些设计好的界面拓展方式，它们都是 `MainWindow::SubUi` 接口的嵌套类。使用时将这些类实例化并配置界面元素，然后调用 MainWindow 上的 `register_sub_ui` 添加到界面上。

上层应用程序也可以通过继承 SubUi 接口来将自己对界面的拓展方式包装为可复用的组件类。

## 偏好保存

`MainWindow::SubUi` 除了用于预设界面拓展方式的类名前缀外，也提供了界面偏好保存的功能。所谓界面偏好保存，是指程序关闭后再次启动时，能够复原上次关闭前的界面状态，这是通过 reset_prefs、dump_prefs、load_prefs 三个虚方法实现的。

预设的界面拓展方式类已经妥善实现好了这三个虚方法，上层应用程序也可以重载这些方法以保存需要的其它信息。

界面偏好会在应用启动时自动加载、退出时自动保存，如果在加载时出错，则会重置界面到默认值。上层应用程序可以通过调用服务的 reset_prefs 等方法手动保存界面偏好到制定文件。偏好文件默认保存在工作目录下的 `.espref`。

## 配置向导

由于机器视觉应用的配置往往有一定的流程和复杂性，配置向导是机器视觉应用的一个常见功能。MainWindow 在界面中为配置向导功能预留了拓展接口。

配置向导本质上是一个对话框，在创建 QDialog 对象后，调用服务的 `register_config_wizard` 方法将对话框注册到界面上。配置向导是可选的，如果界面上没有注册配置向导，界面上的相关元素就不会显示。

唯一需要注意的一点是，配置向导只能注册为一个固定的对象，因此再多次显示时，上层应用应该负责将它重置为初始状态。
