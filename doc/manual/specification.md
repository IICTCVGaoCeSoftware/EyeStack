# 项目规范 {#manual-specification}

## 代码规范

1. 使用 clang-format 的默认 Mozilla 风格格式化代码。

2. 每行代码不超过 80 个英文字符宽度。

3. 注释与代码同等重要，注释要符合中文文档习惯，不要夹杂乱七八糟的空格。

4. 不要用注释来删除代码，除非有明确的将来用途，如果代码没用了立刻删除。

5. 注释应该简短而必要，不要在注释中简单地重复代码逻辑，而应该尽量使代码有自描述性。

6. 不要写没头没尾的垃圾注释，更不要写错误或语义模糊的注释。

7. 注释与 Git 提交信息使用中文，不要用你那蹩脚的英文写中国人看不懂的句子。

8. 正确使用中文标点符号，除非是无需句读的短语。

9. 在中文与英文单词间插入空格，标点符号与英文间无需插入空格。

10. 使用 `#pragma once`，别用头文件卫士，项目是基于 C++17 的，我们已经不是原始人了。

11. 尽可能减少文件间的编译依赖，不要包含没用到的头文件。

12. 一个文件中应该有多少代码？

    |              |                                                                                                  |
    | ------------ | ------------------------------------------------------------------------------------------------ |
    | < 100 行     | 太少了，考虑与其它文件合并，除非在设计上有目的地留为将来拓展。                                   |
    | 100 ~ 1000   | 少，维护起来不费吹灰之力。                                                                       |
    | 1000 ~ 3000  | 一般，此时通常需要在文件中用注释分节来使得文件结构更清晰。                                       |
    | 3000 ~ 5000  | 多，如果没有合适的理由，应该开始考虑将文件拆分。                                                 |
    | 5000 ~ 10000 | 很多，维护起来将比较困难。                                                                       |
    | > 10000      | 太多了，世界上没有多少理由能让你在一个文件中放这么多代码，也许你该了解一下文件系统是用来干啥的。 |

## 命名规范

1. 具体情况具体分析

   一切的准则：代码可读性。

2. 文件、目录

   1. 文件名、目录名区分大小写。
   2. 默认使用**小写 + 下划线**风格，除非有进一步规范。
   3. 固定命名文件（如 CMakeLists.txt、README.md）特殊处理。
   4. C 头文件使用 .h 后缀，源文件使用 .c 后缀。
   5. C++ 头文件使用 .hpp 后缀，源文件使用 .cpp 后缀。
   6. 只包含一个类的头文件、源文件，使用那个类的类名（**Pascal Case**）作为文件名

3. 项目仓库、构建目标

   1. 一般采用 **Pascal Case + 下划线**风格，因为项目名中缩写词比较常用到，而如果使用空格的话，很容易产生兼容性问题。

   2. CMake 项目名（project 命令）采用**Pascal Case**，可以是实际项目名的简化别称，以便遵循 CMake `find_package` 命令的要求。

   3. Git 分支名采用**小写+短划线**风格，例如：`feature/do-something`。

4. 类型

   1. 采用 **Pascal Case**，包括 class、struct、typedef、using 等。

5. 命名空间

   1. 采用 **Pascal Case + 下划线”**，且要与项目名同名。
   2. 在代码前使用 `namespace xyz = Xxx_Yyy_Zzz;` 来为命名空间起别名，避免代码中出现过于冗长的符号。

6. 变量

   1. 局部变量采用 **Camel Case**。
   2. 成员变量前加下划线，例如 `int _counter;`。
   3. 全局变量前加 g，例如 `int gCounter;`。
   4. 静态变量前加 s，例如 `static int sCounter;`。
   5. 常量前加 k，例如 `const float kPi = 3.1415926`。
   6. 枚举前加 e，例如 `enum { eRed = 1, eGreen = 2 }`。
   7. 枚举类使用 **Pascal Case**，例如 `enum class { Red=1, Green=2 }`。

7. 函数

   1. 采用**小写+下划线**风格。
   2. 涉及 Qt 信号与槽机制的函数，使用 Qt 的命名风格（**Camel Case**）。

      信号前加 s\_，例如 `void s_itemChanged();`。

      复合对象上的信号与槽使用**Camel Case + 下划线风格**，例如 `void when_buttonA_textChanged();`。

      只能用连接调用的槽前加 c\_，例如 `void c_changeItem(int);`。

8. 宏

   1. 使用**大写+下划线**风格，并且要加上适当前缀避免冲突。

## 分支工作流

项目采用 Git Flow 分支工作流，分支命名采用默认配置。

# 附录

## A 常见命名风格总结

| 风格                 | 举例      | 优点                                       | 缺点                                              | 常见的场景                           |
| -------------------- | --------- | ------------------------------------------ | ------------------------------------------------- | ------------------------------------ |
| 小写 + 空格          | set name  | 人类通常用法                               | 空格字符在很多地方都不可用                        | 英文提示信息、命令行输出             |
| Pascal Case + 空格   | Set Name  | 人类通常用法                               | 空格字符在很多地方都不可用                        | 英文标题等人类交流场景               |
| 全小写               | name      |                                            | 不能表达包含多个单词的短语                        |                                      |
| 全大写               | NAME      |                                            | 不能表达多个单词的短语                            |                                      |
| 小写+下划线          | set_name  | 易读                                       | 缩写词会与普通单词间产生歧义冲突                  | 无类型语言（如 Python）中的变量命名  |
| 大写+下划线          | SET_NAME  |                                            | 缩写词会与普通单词间产生歧义冲突                  | C/C++宏定义                          |
| Pascal Case          | SetName   | 紧凑                                       |                                                   | 类名                                 |
| Camel Case           | setName   | 紧凑，在只有一个单词的情况下与其它风格兼容 |                                                   | Java 系语言的函数和变量命名          |
| Pascal Case + 下划线 | Set_Name  | 同时可以解决空格和缩写词问题               | 有人觉得这样很丑                                  |                                      |
| Camel Case & 下划线  | set_nameA | 用于两层划分短语                           |                                                   | 构造一个将几个符号简单串接起来的符号 |
| 匈牙利命名法         |           |                                            | 现在被公认为非常狗屎的命名规则， JUST DONT USE IT | Windows API                          |
